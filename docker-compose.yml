version: "3.8"

x-common-variables: &common-variables
  DB_HOST: "db"
  PERIPHERAL_SERVER_ADDR: "peripheral:8080"
  EVENT_SERVER_ADDR: "events:8080"

services:
  peripheral:
    environment: *common-variables
    build:
      context: .
      dockerfile: ./peripheral/Dockerfile
    ports:
      - "6001:8080"
    links:
      - db
  deployment:
    environment: *common-variables
    build:
      context: .
      dockerfile: ./deployment/Dockerfile
    ports:
      - "6003:8080"
    links:
      - db
  user:
    environment: *common-variables
    build:
      context: .
      dockerfile: ./user/Dockerfile
    ports:
      - "6002:8080"
    links:
      - db
  events:
    environment: *common-variables
    build:
      context: .
      dockerfile: ./event/Dockerfile
    ports:
      - "6004:8080"
    links:
      - db
      - peripheral
  db:
    image: mysql:8.0.22
    environment:
      - MYSQL_ROOT_PASSWORD=pw
      - MYSQL_USER=niole
      - MYSQL_PASSWORD=pw
      - MYSQL_DATABASE=default
    ports:
      - "3306:3306"
